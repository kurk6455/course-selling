<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
</head>

<body>
    <div id="Courses">
        <h1>Course list -</h1>
        <div id="courseList">
            <div id="courseName">
                <span style="font-weight: 600;">Course Name - </span>
                <span>${course.courseName}</span>
            </div>
            <div id="instructor">
                <span style="font-weight: 600;">Instructor - </span>
                <span>${course.instructor}</span>
            </div>
            <div id="price">
                <span style="font-weight: 600;">Price - </span>
                <span>${course.price}</span>
            </div>
            <div id="detail">
                <div id="summary">
                    <span style="font-weight: 600;">Summary - </span>
                    <span>${course.detail.summary}</span>
                </div>
                <div id="duration">
                    <span style="font-weight: 600;">Course Duration - </span>
                    <span>${course.detail.duration}</span>
                </div>
                <div id="practiseTest"> 
                    <span style="font-weight: 600;">Practise Test - </span>
                    <span>${course.detail.practiseTest}</span>
                </div>
                <div id="certificate">
                    <span style="font-weight: 600;">Certificate of completion - </span>
                    <span>${course.detail.certificate}</span>
                </div>
            </div>
            <button onclick="deleteCourse('${course._id}')">delete course</button>
            <button onclick="updateCourse('${course._id}')">update course</button>
            <br><br>
        </div>
    </div>

    </div>
    <div id="couseDetailForm">
        <h3>Add Course -</h3>
        <input type="text" id="courseNameBox" placeholder="Enter course name ..." />
        <input type="text" id="instructorBox" placeholder="Enter course instructor ..." />
        <input type="text" id="priceBox" placeholder="Enter course price ..." />
        <div>
            <p>Detail - </p>
            <input type="text" id="summaryBox" placeholder="Enter course summary ..." />
            <input type="text" id="durationBox" placeholder="Enter course duration ..." />
            <input type="text" id="practiseTestBox" placeholder="Enter course practiseTest ..." /><br />
        </div>
        <label for="certificate">Certificate of completion -</label>
        <input type="checkbox" id="certificateBox" checked><br><br>
        <button id="addBtn" onclick="addCourse(id)">Add Course</button>
    </div>


    <script>
        //select all the element from courseListForm
        const courseList = document.getElementById('courseList');
        const courseNameBox = document.getElementById('courseNameBox');
        const instructorBox = document.getElementById('instructorBox');
        const priceBox = document.getElementById('priceBox');
        const summaryBox = document.getElementById('summaryBox');
        const durationBox = document.getElementById('durationBox');
        const practiseTestBox = document.getElementById('practiseTestBox');
        const certificateBox = document.getElementById('certificateBox');


        async function onLoad() {
            try {
                const response = await axios({
                    method: 'get',
                    url: 'http://localhost:3000/courses',
                })

                const { courses } = response.data;
                courseList.innerHTML = "";

                courses.forEach(course => {
                    //Create a new div element
                    const courseEle = document.createElement('div');
                    courseEle.innerHTML = `
                    <div id="courseName">
                        <span style="font-weight: 600;">Course Name - </span>
                        <span>${course.courseName}</span>
                    </div>
                    <div id="instructor">
                        <span style="font-weight: 600;">Instructor - </span>
                        <span>${course.instructor}</span>
                    </div>
                    <div id="price">
                        <span style="font-weight: 600;">Price - </span>
                        <span>${course.price}</span>
                    </div>
                    <div id="detail">
                        <div id="summary">
                            <span style="font-weight: 600;">Summary - </span>
                            <span>${course.detail.summary}</span>
                        </div>
                        <div id="duration">
                            <span style="font-weight: 600;">Course Duration - </span>
                            <span>${course.detail.duration}</span>
                        </div>
                        <div id="practiseTest"> 
                            <span style="font-weight: 600;">Practise Test - </span>
                            <span>${course.detail.practiseTest}</span>
                        </div>
                        <div id="certificate">
                            <span style="font-weight: 600;">Certificate of completion - </span>
                            <span>${course.detail.certificate}</span>
                        </div>
                    </div>
                    <button onclick="deleteCourse('${course._id}')">delete course</button>
                    <button onclick="updateCourse('${course._id}')">update course</button>
                    <br><br>`;

                    courseEle.setAttribute('class', 'course');
                    courseEle.setAttribute('id', course._id);


                    courseList.appendChild(courseEle);
                });
            } catch (e) {
                console.log(e);
            }
        }
        onLoad();


        async function addCourse() {
            //Extract values
            const courseName = courseNameBox.value;
            const instructor = instructorBox.value;
            const price = priceBox.value;
            const duration = durationBox.value;
            const summary = summaryBox.value;
            const practiseTest = practiseTestBox.value;
            let certificate = false;
            if (certificateBox.value === 'on') {
                certificate = true
            }

            console.log(certificate);

            //Create a new div element
            const courseEle = document.createElement('div');
            courseEle.innerHTML = `
            <div id="courseName">
                <span style="font-weight: 600;">Course Name - </span>
                <span>${courseName}</span>
            </div>
            <div id="instructor">
                <span style="font-weight: 600;">Instructor - </span>
                <span>${instructor}</span>
            </div>
            <div id="price">
                <span style="font-weight: 600;">Price - </span>
                <span>${price}</span>
            </div>
            <div id="detail">
                <div id="summary">
                    <span style="font-weight: 600;">Summary - </span>
                    <span>${summary}</span>
                </div>
                <div id="duration">
                    <span style="font-weight: 600;">Course Duration - </span>
                    <span>${duration}</span>
                </div>
                <div id="practiseTest"> 
                    <span style="font-weight: 600;">Practise Test - </span>
                    <span>${practiseTest}</span>
                </div>
                <div id="certificate">
                    <span style="font-weight: 600;">Certificate of completion - </span>
                    <span>${certificate}</span>
                </div>
            </div>
            <br><br>`;
            //Update it's style
            courseEle.style.opacity = 0.5;

            //Append it to courseListForm
            courseList.appendChild(courseEle);
            courseNameBox.value = ""; instructorBox.value = ""; priceBox.value = "";
            summaryBox.value = ""; durationBox.value = ""; practiseTestBox.value = "";
            certificateBox.value = "";

            try {
                const response = await axios({
                    method: 'post',
                    url: 'http://localhost:3000/course',
                    data: {
                        courseName, instructor, price, detail: { summary, duration, practiseTest, certificate }
                    }
                })

                const { course } = response.data;
                console.log(course);
                courseEle.innerHTML = `
                <div id="courseName">
                    <span style="font-weight: 600;">Course Name - </span>
                    <span>${course.courseName}</span>
                </div>
                <div id="instructor">
                    <span style="font-weight: 600;">Instructor - </span>
                    <span>${course.instructor}</span>
                </div>
                <div id="price">
                    <span style="font-weight: 600;">Price - </span>
                    <span>${course.price}</span>
                </div>
                <div id="detail">
                    <div id="summary">
                        <span style="font-weight: 600;">Summary - </span>
                        <span>${course.detail.summary}</span>
                    </div>
                    <div id="duration">
                        <span style="font-weight: 600;">Course Duration - </span>
                        <span>${course.detail.duration}</span>
                    </div>
                    <div id="practiseTest"> 
                        <span style="font-weight: 600;">Practise Test - </span>
                        <span>${course.detail.practiseTest}</span>
                    </div>
                    <div id="certificate">
                        <span style="font-weight: 600;">Certificate of completion - </span>
                        <span>${course.detail.certificate}</span>
                    </div>
                </div>
                <button onclick="deleteCourse('${course._id}')">delete course</button>
                <button onclick="updateCourse('${course._id}')">update course</button>
                <br><br>`;
                courseEle.setAttribute('class', 'course');
                courseEle.setAttribute('id', course._id);
                courseEle.style.opacity = 1;

            } catch (e) {
                console.log(e);
            }
        }

        async function deleteCourse(id) {
            const ele = document.getElementById(id);
            ele.parentNode.removeChild(ele);

            try {
                const response = await axios({
                    method: 'delete',
                    url: 'http://localhost:3000/course',
                    data: {
                        courseId: id
                    }
                })

                console.log(response.data);
            } catch (e) {
                console.log(e);
            }
        }

        function updateCourse(id) {
            const courseEle = document.getElementById(id);

            //select all the element from ele
            const courseName = courseEle.querySelector('#courseName > span:nth-child(2)').textContent;
            const instructor = courseEle.querySelector('#instructor > span:nth-child(2)').textContent;
            const price = courseEle.querySelector('#price > span:nth-child(2)').textContent;
            const summary = courseEle.querySelector('#summary > span:nth-child(2)').textContent;
            const duration = courseEle.querySelector('#duration > span:nth-child(2)').textContent;
            const practiseTest = courseEle.querySelector('#practiseTest > span:nth-child(2)').textContent;
            const certificate = courseEle.querySelector('#certificate > span:nth-child(2)').textContent;

            //creating an updating form in the same instance
            courseEle.innerHTML = `
            <input type="text" id="courseNameBox" value="${courseName}" required/>
            <input type="text" id="instructorBox" value="${instructor}" required/>
            <input type="text" id="priceBox" value="${price}" required/>
            <div>
                <p>Detail - </p>
                <input type="text" id="summaryBox" value="${summary}" required/>
                <input type="text" id="durationBox" value="${duration}" required/>
                <input type="text" id="practiseTestBox" value="${practiseTest}" required/><br />
            </div>
            <label for="certificate">Certificate of completion -</label>
            <input type="checkbox" id="certificateBox" checked><br><br>
            <button id="saveBtn" onclick="saveCourse('${id}')">Save Course</button>
            <br><br>`;
        }

        async function saveCourse(id) {
            const courseEle = document.getElementById(id);

            //select all the value of element from ele form
            const courseName = courseEle.querySelector('#courseNameBox').value;
            const instructor = courseEle.querySelector('#instructorBox').value;
            const price = courseEle.querySelector('#priceBox').value;
            const summary = courseEle.querySelector('#summaryBox').value;
            const duration = courseEle.querySelector('#durationBox').value;
            const practiseTest = courseEle.querySelector('#practiseTestBox').value;
            let certificate = courseEle.querySelector('#certificateBox').value;
            if (certificate == 'on') certificate = true;
            else certificate = false;

            courseEle.innerHTML = `
            <div id="courseName">
                <span style="font-weight: 600;">Course Name - </span>
                <span>${courseName}</span>
            </div>
            <div id="instructor">
                <span style="font-weight: 600;">Instructor - </span>
                <span>${instructor}</span>
            </div>
            <div id="price">
                <span style="font-weight: 600;">Price - </span>
                <span>${price}</span>
            </div>
            <div id="detail">
                <div id="summary">
                    <span style="font-weight: 600;">Summary - </span>
                    <span>${summary}</span>
                </div>
                <div id="duration">
                    <span style="font-weight: 600;">Course Duration - </span>
                    <span>${duration}</span>
                </div>
                <div id="practiseTest"> 
                    <span style="font-weight: 600;">Practise Test - </span>
                    <span>${practiseTest}</span>
                </div>
                <div id="certificate">
                    <span style="font-weight: 600;">Certificate of completion - </span>
                    <span>${certificate}</span>
                </div>
            </div>
            <br><br>`;
            courseEle.style.opacity = 0.5;

            try {
                const response = await axios({
                    method: 'put',
                    url: 'http://localhost:3000/course',
                    data: {
                        courseId: id, courseName, instructor, price, detail: { summary, duration, practiseTest, certificate }
                    }
                })

                const { course } = response.data;
                courseEle.innerHTML = `
                <div id="courseName">
                    <span style="font-weight: 600;">Course Name - </span>
                    <span>${course.courseName}</span>
                </div>
                <div id="instructor">
                    <span style="font-weight: 600;">Instructor - </span>
                    <span>${course.instructor}</span>
                </div>
                <div id="price">
                    <span style="font-weight: 600;">Price - </span>
                    <span>${course.price}</span>
                </div>
                <div id="detail">
                    <div id="summary">
                        <span style="font-weight: 600;">Summary - </span>
                        <span>${course.detail.summary}</span>
                    </div>
                    <div id="duration">
                        <span style="font-weight: 600;">Course Duration - </span>
                        <span>${course.detail.duration}</span>
                    </div>
                    <div id="practiseTest"> 
                        <span style="font-weight: 600;">Practise Test - </span>
                        <span>${course.detail.practiseTest}</span>
                    </div>
                    <div id="certificate">
                        <span style="font-weight: 600;">Certificate of completion - </span>
                        <span>${course.detail.certificate}</span>
                    </div>
                </div>
                <button onclick="deleteCourse('${course._id}')">delete course</button>
                <button onclick="updateCourse('${course._id}')">update course</button>
                <br><br>`;
                courseEle.style.opacity = 1;
            } catch (e) {
                console.log(e);
            }
        }
    </script>
</body>

</html>
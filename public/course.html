<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
</head>

<body>
    <div id="courseList">
        <h1>Course list -</h1>
        
    </div>

    </div>
    <div id="couseDetailForm">
        <h3>Add Course -</h3>
        <input type="text" id="courseNameBox" placeholder="Enter course name ..." />
        <input type="text" id="instructorBox" placeholder="Enter course instructor ..." />
        <input type="text" id="priceBox" placeholder="Enter course price ..." />
        <div>
            <p>Detail - </p>
            <input type="text" id="summaryBox" placeholder="Enter course summary ..." />
            <input type="text" id="durationBox" placeholder="Enter course duration ..." />
            <input type="text" id="practiseTestBox" placeholder="Enter course practiseTest ..." /><br />
        </div>
        <label for="certificate">Certificate of completion -</label>
        <input type="checkbox" id="certificateBox" checked><br><br>
        <button id="addBtn" onclick="addCourse(id)">Add Course</button>
    </div>


    <script>
        //select all the element from courseListForm
        const courseList = document.getElementById('courseList');
        const courseNameBox = document.getElementById('courseNameBox');
        const instructorBox = document.getElementById('instructorBox');
        const priceBox = document.getElementById('priceBox');
        const summaryBox = document.getElementById('summaryBox');
        const durationBox = document.getElementById('durationBox');
        const practiseTestBox = document.getElementById('practiseTestBox');
        const certificateBox = document.getElementById('certificateBox');


        async function onLoad(){
            try{
                const response = await axios({
                    method : 'get',
                    url : 'http://localhost:3000/courses',
                })

                const {courses} = response.data;
                const len = courses.length;

                courses.forEach( course => {
                    //Create a new div element
                    const courseEle = document.createElement('div');
                    courseEle.innerHTML = `
                    <div  id="courseName">Course Name - ${course.courseName}</div>
                    <div  id="instructor">Instructor - ${course.instructor}</div>
                    <div  id="price">Price - ${course.price}</div>
                    <div id="detail">
                        <div  id="summary">Summary - ${course.detail.summary}</div>
                        <div  id="duration">hrs - ${course.detail.duration}</div>
                        <div  id="practiseTest">Practise Test - ${course.detail.practiseTest}</div>
                        <div  id="certificate">Certificate of completion - ${course.detail.certificate}</div>
                    </div>
                    <button onclick="deleteCourse('${course._id}')">delete course</button>
                    <button onclick="updateCourse('${course._id}')">update course</button>
                    <br><br>`;

                    courseEle.style.fontWeight = 500;
                    courseEle.setAttribute('class', 'course');
                    courseEle.setAttribute('id', course._id);


                    courseList.appendChild(courseEle);
                });
            }catch(e){
                console.log(e);
            }
        }
        onLoad();


        async function addCourse() {
            //Extract values
            const courseName = courseNameBox.value;
            const instructor = instructorBox.value;
            const price = priceBox.value;
            const duration = durationBox.value;
            const summary = summaryBox.value;
            const practiseTest = practiseTestBox.value;
            let certificate = false;
            if (certificateBox.value === 'on') {
                certificate = true
            }

            console.log(certificate);

            //Create a new div element
            const courseEle = document.createElement('div');
            courseEle.innerHTML = `
            <div  id="courseName">Course Name - ${courseName}</div>
            <div  id="instructor">Instructor - ${instructor}</div>
            <div  id="price">Price - ${price}</div>
            <div id="detail">
                <div  id="summary">Summary - ${summary}</div>
                <div  id="duration">hrs - ${duration}</div>
                <div  id="practiseTest">Practise Test - ${practiseTest}</div>
                <div  id="certificate">Certificate of completion - ${certificate}</div>
            </div>`;
            //Update it's style
            courseEle.style.fontWeight = 500;
            courseEle.style.opacity = 0.5;

            //Append it to courseListForm
            courseList.appendChild(courseEle);
            courseNameBox.value = ""; instructorBox.value = ""; priceBox.value = "";
            summaryBox.value = ""; durationBox.value = ""; practiseTestBox.value = "";
            certificateBox.value = "";

            try {
                const response = await axios({
                    method: 'post',
                    url: 'http://localhost:3000/course',
                    data: {
                        courseName, instructor, price, detail: { summary, duration, practiseTest, certificate }
                    }
                })

                const { course } = response.data;
                console.log(course);
                courseEle.innerHTML = `
                <div  id="courseName">Course Name - ${course.courseName}</div>
                <div  id="instructor">Instructor - ${course.instructor}</div>
                <div  id="price">Price - ${course.price}</div>
                <div id="detail">
                    <div  id="summary">Summary - ${course.detail.summary}</div>
                    <div  id="duration">hrs - ${course.detail.duration}</div>
                    <div  id="practiseTest">Practise Test - ${course.detail.practiseTest}</div>
                    <div  id="certificate">Certificate of completion - ${course.detail.certificate}</div>
                </div>
                <button onclick="deleteCourse('${course._id}')">delete course</button>
                <button onclick="updateCourse('${course._id}')">update course</button>
                <br><br>`;
                courseEle.setAttribute('class', 'course');
                courseEle.setAttribute('id', course._id);
                courseEle.style.opacity = 1;

            } catch (e) {
                console.log(e);
            }
        }

        async function deleteCourse(id) {
            const ele = document.getElementById(id);
            ele.parentNode.removeChild(ele);

            try {
                const response = await axios({
                    method: 'delete',
                    url: 'http://localhost:3000/course',
                    data: {
                        courseId: id
                    }
                })

                console.log(response.data);
            } catch (e) {
                console.log(e);
            }
        }

        function updateCourse(id) {
            const ele = document.getElementById(id);

            //select all the element from ele
            const courseName = ele.querySelector('#courseName').textContent;
            const instructor = ele.querySelector('#instructor').textContent;
            const price = ele.querySelector('#price').textContent;
            const summary = ele.querySelector('#summary').textContent;
            const duration = ele.querySelector('#duration').textContent;
            const practiseTest = ele.querySelector('#practiseTest').textContent;
            const certificate = ele.querySelector('#certificate').textContent;

            //creating an updating form in the same instance
            ele.innerHTML = `
            <input type="text" id="courseNameBox" placeholder="${courseName} ..." required/>
            <input type="text" id="instructorBox" placeholder="${instructor} ..." required/>
            <input type="text" id="priceBox" placeholder="${price} ..." required/>
            <div>
                <p>Detail - </p>
                <input type="text" id="summaryBox" placeholder="${summary} ..." required/>
                <input type="text" id="durationBox" placeholder="${duration} ..." required/>
                <input type="text" id="practiseTestBox" placeholder="${practiseTest} ..." required/><br />
            </div>
            <label for="certificate">Certificate of completion -</label>
            <input type="checkbox" id="certificateBox" checked><br><br>
            <button id="saveBtn" onclick="saveCourse('${id}')">Save Course</button>
            <br><br>`;
        }

        async function saveCourse(id) {
            const ele = document.getElementById(id);
            //select all the value of element from ele form
            const courseName = ele.querySelector('#courseNameBox').value;
            const instructor = ele.querySelector('#instructorBox').value;
            const price = ele.querySelector('#priceBox').value;
            const summary = ele.querySelector('#summaryBox').value;
            const duration = ele.querySelector('#durationBox').value;
            const practiseTest = ele.querySelector('#practiseTestBox').value;
            let certificate = ele.querySelector('#certificateBox').value;  
            if(certificate == 'on') certificate = true;
            else certificate = false;      

            ele.innerHTML = `
            <div  id="courseName">Course Name - ${courseName}</div>
            <div  id="instructor">Instructor - ${instructor}</div>
            <div  id="price">Price - ${price}</div>
            <div id="detail">
                <div  id="summary">Summary - ${summary}</div>
                <div  id="duration">hrs - ${duration}</div>
                <div  id="practiseTest">Practise Test - ${practiseTest}</div>
                <div  id="certificate">Certificate of completion - ${certificate}</div>
            </div>`;
            ele.style.opacity = 0.5;

            try {
                console.log("client side - try block")
                const response = await axios({
                    method: 'put',
                    url: 'http://localhost:3000/course',
                    data: {
                        courseId : id, courseName, instructor, price, detail: { summary, duration, practiseTest, certificate }
                    }
                })

                console.log("client side - after response")

                const {course} = response.data;
                ele.innerHTML = `
                <div  id="courseName">Course Name - ${course.courseName}</div>
                <div  id="instructor">Instructor - ${course.instructor}</div>
                <div  id="price">Price - ${course.price}</div>
                <div id="detail">
                    <div  id="summary">Summary - ${course.detail.summary}</div>
                    <div  id="duration">hrs - ${course.detail.duration}</div>
                    <div  id="practiseTest">Practise Test - ${course.detail.practiseTest}</div>
                    <div  id="certificate">Certificate of completion - ${course.detail.certificate}</div>
                </div>
                <button onclick="deleteCourse('${course._id}')">delete course</button>
                <button onclick="updateCourse('${course._id}')">update course</button>
                <br><br>`;
                ele.style.opacity = 1;
            } catch (e) {
                console.log(e);
            }
        }
    </script>
</body>

</html>